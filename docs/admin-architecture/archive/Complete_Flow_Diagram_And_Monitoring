 ðŸ“Š Je Monitoring Stack - Prometheus + Grafana

  ðŸŽ¯ Wat het voor je doet:

  Prometheus (Data Collector):
  - Verzamelt metrics van al je services elke 15-30 seconden
  - Monitort: API performance, database health, job processing, system resources
  - Slaat tijdreeks data op (hoeveel jobs per minuut, response times, etc.)

  Grafana (Visualisatie Dashboard):
  - Mooie dashboards met grafieken en alerts
  - Real-time monitoring van je AgentOS performance
  - Alert systeem voor problemen (te veel failed jobs, database overload)

  ðŸ”§ Wat wordt gemonitord:

  1. AgentOS API (port 8001) - Response times, error rates
  2. PostgreSQL (port 9187) - Query performance, connections, job counts
  3. WebSocket (port 8765) - Real-time connection metrics
  4. Redis (port 9121) - Queue performance, memory usage
  5. System (port 9100) - CPU, memory, disk usage

  ðŸŽ¯ Complete AgentOS Data Flow (Updated)

  ðŸŽ¬ USER INTERACTION
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    FRONTEND LAYER                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ UI-v2 (8000) â† Manual Upload                               â”‚
  â”‚ Admin UI (8004) â† Jobs & Queue Management                  â”‚
  â”‚    â†“                                                        â”‚
  â”‚ Central Data Service (SSOT Pattern)                        â”‚
  â”‚    â†“                                                        â”‚
  â”‚ WebSocket Service â† Real-time updates                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                     API GATEWAY                             â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚FastAPI Server (8001) â† 39 endpoints âœ…                    â”‚
  â”‚ â”œâ”€â”€ Authentication & Authorization                          â”‚
  â”‚ â”œâ”€â”€ Rate Limiting & Validation                             â”‚
  â”‚ â”œâ”€â”€ Prometheus Metrics Export (/metrics)                   â”‚
  â”‚ â””â”€â”€ SSOT Endpoint (/api/admin/ssot)                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                   SERVICE LAYER                             â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ AdminDataManager â† SSOT Controller                         â”‚
  â”‚ JobsService â† Business Logic                               â”‚
  â”‚ â”œâ”€â”€ File validation & processing                           â”‚
  â”‚ â”œâ”€â”€ Job creation & status management                       â”‚
  â”‚ â”œâ”€â”€ User permission checks                                 â”‚
  â”‚ â””â”€â”€ Progress tracking                                       â”‚
  â”‚    â†“                                                        â”‚
  â”‚ QueueService â† Distributed Task Management                 â”‚
  â”‚ â”œâ”€â”€ Celery task queuing                                    â”‚
  â”‚ â”œâ”€â”€ Worker assignment & load balancing                     â”‚
  â”‚ â”œâ”€â”€ Retry logic & error handling                           â”‚
  â”‚ â””â”€â”€ Performance monitoring                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                  PROCESSING LAYER                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Celery Workers (Multiple instances)                        â”‚
  â”‚ â”œâ”€â”€ video_downloader â† File acquisition                    â”‚
  â”‚ â”œâ”€â”€ audio_transcriber â† Speech to text (Whisper)          â”‚
  â”‚ â”œâ”€â”€ moment_detector â† Viral moment AI (Claude)            â”‚
  â”‚ â”œâ”€â”€ face_detector â† Computer vision                        â”‚
  â”‚ â”œâ”€â”€ intelligent_cropper â† Platform optimization           â”‚
  â”‚ â””â”€â”€ video_cutter â† Final clip generation                   â”‚
  â”‚    â†“                                                        â”‚
  â”‚ Redis Queue â† Task coordination                            â”‚
  â”‚ â”œâ”€â”€ Job prioritization                                     â”‚
  â”‚ â”œâ”€â”€ Worker health monitoring                               â”‚
  â”‚ â””â”€â”€ Real-time progress updates                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    DATA LAYER                               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ PostgreSQL Database â† Production data store                â”‚
  â”‚ â”œâ”€â”€ Jobs table (status, progress, metadata)               â”‚
  â”‚ â”œâ”€â”€ Users table (authentication, credits)                 â”‚
  â”‚ â”œâ”€â”€ Clips table (generated videos, analytics)             â”‚
  â”‚ â”œâ”€â”€ Processing steps (audit trail)                        â”‚
  â”‚ â””â”€â”€ System logs (debugging, monitoring)                   â”‚
  â”‚    â†“                                                        â”‚
  â”‚ File System â† Media storage                                â”‚
  â”‚ â”œâ”€â”€ ./io/input/ â† Uploaded videos                         â”‚
  â”‚ â””â”€â”€ ./io/output/ â† Generated clips                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                 MONITORING LAYER                            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Prometheus (9090) â† Metrics collection                     â”‚
  â”‚ â”œâ”€â”€ API performance (response times, error rates)         â”‚
  â”‚ â”œâ”€â”€ Database health (connections, query performance)      â”‚
  â”‚ â”œâ”€â”€ Job processing (throughput, success rates)            â”‚
  â”‚ â”œâ”€â”€ Worker performance (task completion, failures)        â”‚
  â”‚ â””â”€â”€ System resources (CPU, memory, disk)                  â”‚
  â”‚    â†“                                                        â”‚
  â”‚ Grafana (3000) â† Visualization & alerting                 â”‚
  â”‚ â”œâ”€â”€ Real-time dashboards                                   â”‚
  â”‚ â”œâ”€â”€ Performance trend analysis                             â”‚
  â”‚ â”œâ”€â”€ Alert notifications (Slack, email)                    â”‚
  â”‚ â””â”€â”€ Business intelligence reports                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
  ðŸŽ¯ USER RECEIVES PROCESSED CLIPS

  ðŸš€ Hoe je Monitoring gebruikt:

  ðŸ“ˆ Grafana Dashboards:

  # Access Grafana
  http://localhost:3000

  # Key dashboards:
  - AgentOS Performance Overview
  - PostgreSQL Database Health
  - Job Processing Analytics
  - System Resource Monitoring

  ðŸ” Prometheus Queries:

  # Access Prometheus
  http://localhost:9090

  # Example queries:
  - agentos_jobs_by_status_count  # Job status breakdown
  - rate(http_requests_total[5m])  # API request rate
  - pg_stat_activity_count        # Database connections

  âš ï¸ Alerts Setup:

  - High job failure rate â†’ Slack notification
  - Database connection limit â†’ Email alert
  - API response time > 2s â†’ Dashboard warning
  - Disk space < 10% â†’ Critical alert

  Dit geeft je enterprise-grade monitoring van je hele video processing pipeline! ðŸ“ŠðŸš€